{"version":3,"sources":["../../src/query/tabsequence.sort-area.js"],"names":[],"mappings":";;;;;;;;;;;;;;;yBAGsB,YAAY;;;;QAC3B,2BAA2B;;wBACR,YAAY;;;;iCACV,yBAAyB;;;;+BAC7B,sBAAsB;;;;IAExC,IAAI;AACG,WADP,IAAI,CACI,OAAO,EAAE;0BADjB,IAAI;;AAEN,QAAI,CAAC,SAAS,GAAG,kCAAY,OAAO,CAAC,CAAC;AACtC,QAAI,CAAC,IAAI,GAAG,EAAE,CAAC;GAChB;;eAJG,IAAI;;WAMG,qBAAC,IAAI,EAAE;AAChB,UAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;;;AAGpB,YAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;OACzB;;AAED,aAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACxB;;;WAEW,sBAAC,IAAI,EAAE;;;AAGjB,UAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,YAAY,GAAG,4BAAU,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,IAAI,CAAC;AACxF,UAAI,CAAC,GAAG,EAAE;;AAER,eAAO;OACR;;AAED,UAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,2BAAc,EAAC,OAAO,EAAE,GAAG,EAAC,CAAC,CAAC;KACrD;;;WAEmB,8BAAC,QAAQ,EAAE;;;AAG7B,aAAO,QAAQ,CAAC,MAAM,CAAC,UAAS,OAAO,EAAE;AACvC,YAAM,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;AAChD,YAAI,QAAQ,KAAK,MAAM,EAAE;AACvB,iBAAO,IAAI,CAAC;SACb;;AAED,YAAM,GAAG,GAAG,OAAO,CAAC,UAAU,CAAC;AAC/B,YAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;AACxB,cAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;SAC1B;;AAED,YAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAClC,eAAO,KAAK,CAAC;OACd,EAAE,IAAI,CAAC,CAAC;KACV;;;SA7CG,IAAI;;;qBAgDK,UAAS,QAAQ,EAAE,OAAO,EAAE;;;;AAIzC,MAAM,OAAO,GAAG,OAAO,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;AACxD,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC;;;;AAI/B,MAAM,SAAS,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;;AAEtD,MAAI,CAAC,OAAO,CAAC,MAAM,EAAE;;;AAGnB,WAAO,SAAS,CAAC;GAClB;;AAED,SAAO,oCAAgB;AACrB,QAAI,EAAE,SAAS;AACf,YAAQ,EAAE,OAAO;AACjB,kBAAc,EAAE,wBAAS,KAAK,EAAE;AAC9B,UAAM,IAAI,GAAG,KAAK,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACnD,aAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;KAC/B;GACF,CAAC,CAAC;CACJ","file":"tabsequence.sort-area.js","sourcesContent":["\n// move <area> elements to the location of the <img> elements that reference them\n\nimport cssEscape from 'css.escape';\nimport 'array.prototype.findindex';\nimport queryTabbable from './tabbable';\nimport mergeInDomOrder from '../util/merge-dom-order';\nimport getDocument from '../util/get-document';\n\nclass Maps {\n  constructor(context) {\n    this._document = getDocument(context);\n    this.maps = {};\n  }\n\n  getAreasFor(name) {\n    if (!this.maps[name]) {\n      // the map is not defined within the context, so we\n      // have to go find it elsewhere in the document\n      this.addMapByName(name);\n    }\n\n    return this.maps[name];\n  }\n\n  addMapByName(name) {\n    // apparently getElementsByName() also considers id attribute in IE & opera\n    // https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByName\n    const map = this._document.querySelector('map[name=\"' + cssEscape(name) + '\"]') || null;\n    if (!map) {\n      // if there is no map, the img[usemap] wasn't doing anything anyway\n      return;\n    }\n\n    this.maps[map.name] = queryTabbable({context: map});\n  }\n\n  extractAreasFromList(elements) {\n    // remove all <area> elements from the elements list,\n    // but put them the map for later retrieval\n    return elements.filter(function(element) {\n      const nodeName = element.nodeName.toLowerCase();\n      if (nodeName !== 'area') {\n        return true;\n      }\n\n      const map = element.parentNode;\n      if (!this.maps[map.name]) {\n        this.maps[map.name] = [];\n      }\n\n      this.maps[map.name].push(element);\n      return false;\n    }, this);\n  }\n}\n\nexport default function(elements, context) {\n  // images - unless they are focusable themselves, likely not\n  // part of the elements list, so we'll have to find them and\n  // sort them into the elements list manually\n  const usemaps = context.querySelectorAll('img[usemap]');\n  const maps = new Maps(context);\n\n  // remove all <area> elements from the elements list,\n  // but put them the map for later retrieval\n  const _elements = maps.extractAreasFromList(elements);\n\n  if (!usemaps.length) {\n    // the context does not contain any <area>s so no need\n    // to replace anything, just remove any maps\n    return _elements;\n  }\n\n  return mergeInDomOrder({\n    list: _elements,\n    elements: usemaps,\n    resolveElement: function(image) {\n      const name = image.getAttribute('usemap').slice(1);\n      return maps.getAreasFor(name);\n    },\n  });\n}\n"]}