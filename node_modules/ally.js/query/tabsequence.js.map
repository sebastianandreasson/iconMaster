{"version":3,"sources":["../../src/query/tabsequence.js"],"names":[],"mappings":";;;;;;;;;;;;wBAIqB,UAAU;;;;wBACL,YAAY;;;;6BAChB,oBAAoB;;;;mCACrB,yBAAyB;;;;uCACrB,6BAA6B;;;;uCAC7B,6BAA6B;;;;mCAChC,wBAAwB;;;;AAC9C,IAAI,QAAQ,YAAA,CAAC;;AAEb,SAAS,sBAAsB,CAAC,QAAQ,EAAE,OAAO,EAAE;AACjD,MAAM,GAAG,GAAG,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;AACtC,MAAI,GAAG,GAAG,CAAC,EAAE;AACX,QAAM,GAAG,GAAG,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;AACpC,WAAO,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;GAC7B;;AAED,SAAO,QAAQ,CAAC;CACjB;;AAED,SAAS,YAAY,CAAC,QAAQ,EAAE,QAAQ,EAAE;AACxC,UAAQ,GAAG,0CAAa,QAAQ,CAAC,CAAC;;AAElC,MAAI,QAAQ,CAAC,mCAAmC,EAAE;;;;AAIhD,YAAQ,GAAG,sCAAS,QAAQ,EAAE,QAAQ,CAAC,CAAC;GACzC;;AAED,SAAO,QAAQ,CAAC;CACjB;;qBAEc,YAAmD;mEAAJ,EAAE;;MAAvC,OAAO,QAAP,OAAO;MAAE,cAAc,QAAd,cAAc;MAAE,QAAQ,QAAR,QAAQ;;AACxD,MAAI,CAAC,QAAQ,EAAE;AACb,YAAQ,GAAG,uCAAW,CAAC;GACxB;;AAED,MAAM,QAAQ,GAAG,gCAAU,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,QAAQ,CAAC,eAAe,CAAC;AACnE,MAAI,QAAQ,GAAG,2BAAc,EAAC,OAAO,EAAE,QAAQ,EAAE,cAAc,EAAd,cAAc,EAAE,QAAQ,EAAR,QAAQ,EAAC,CAAC,CAAC;;AAE5E,MAAI,QAAQ,CAAC,IAAI,CAAC,gBAAgB,KAAK,sBAAS,IAAI,KAAK,QAAQ,IAAI,sBAAS,IAAI,KAAK,eAAe,CAAA,AAAC,EAAE;;;AAGvG,YAAQ,GAAG,0CAAa,QAAQ,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAC;GAC3D,MAAM;AACL,YAAQ,GAAG,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;GAC7C;;AAED,MAAI,cAAc,EAAE;;;AAGlB,YAAQ,GAAG,sBAAsB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;GACvD;;AAED,SAAO,QAAQ,CAAC;CACjB","file":"tabsequence.js","sourcesContent":["\n// http://www.w3.org/TR/html5/editing.html#sequential-focus-navigation-and-the-tabindex-attribute\n// http://www.w3.org/WAI/PF/aria-practices/#keyboard\n\nimport platform from 'platform';\nimport queryTabbable from './tabbable';\nimport nodeArray from '../util/node-array';\nimport sortArea from './tabsequence.sort-area';\nimport sortShadowed from './tabsequence.sort-shadowed';\nimport sortTabindex from './tabsequence.sort-tabindex';\nimport _supports from './tabsequence.supports';\nlet supports;\n\nfunction moveContextToBeginning(elements, context) {\n  const pos = elements.indexOf(context);\n  if (pos > 0) {\n    const tmp = elements.splice(pos, 1);\n    return tmp.concat(elements);\n  }\n\n  return elements;\n}\n\nfunction sortElements(elements, _context) {\n  elements = sortTabindex(elements);\n\n  if (supports.tabsequenceSortsAreaAtImagePosition) {\n    // Some browsers sort <area> in DOM order, some place the <area>s\n    // where the <img> referecing them would've been in DOM order.\n    // https://github.com/medialize/ally.js/issues/5\n    elements = sortArea(elements, _context);\n  }\n\n  return elements;\n}\n\nexport default function({context, includeContext, strategy} = {}) {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  const _context = nodeArray(context)[0] || document.documentElement;\n  let elements = queryTabbable({context: _context, includeContext, strategy});\n\n  if (document.body.createShadowRoot && (platform.name === 'Chrome' || platform.name === 'Chrome Mobile')) {\n    // sort tabindex localized to shadow dom\n    // see https://github.com/medialize/ally.js/issues/6\n    elements = sortShadowed(elements, _context, sortElements);\n  } else {\n    elements = sortElements(elements, _context);\n  }\n\n  if (includeContext) {\n    // if we include the context itself, it has to be the first\n    // element of the sequence\n    elements = moveContextToBeginning(elements, _context);\n  }\n\n  return elements;\n}\n"]}