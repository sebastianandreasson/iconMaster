{"version":3,"sources":["../../src/get/insignificant-branches.js"],"names":[],"mappings":";;;;;;;;;;;;;;;6BAOsB,oBAAoB;;;;mCACR,0BAA0B;;+BACpC,sBAAsB;;;;AAE9C,SAAS,0BAA0B,CAAC,IAAiB,EAAE;MAAlB,OAAO,GAAR,IAAiB,CAAhB,OAAO;MAAE,MAAM,GAAhB,IAAiB,CAAP,MAAM;;AAClD,MAAM,uBAAuB,GAAG,SAA1B,uBAAuB,CAAY,IAAI,EAAE;AAC7C,QAAM,YAAY,GAAG,8CAAoB,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC;AACzD,WAAO,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;GAClC,CAAC;;;AAGF,MAAM,sBAAsB,GAAG,EAAE,CAAC;;;AAGlC,MAAM,kCAAkC,GAAG,SAArC,kCAAkC,CAAY,IAAI,EAAE;AACxD,QAAI,MAAM,CAAC,IAAI,CAAC,UAAA,OAAO;aAAI,IAAI,KAAK,OAAO;KAAA,CAAC,EAAE;;AAE5C,aAAO,UAAU,CAAC,aAAa,CAAC;KACjC;;AAED,QAAI,uBAAuB,CAAC,IAAI,CAAC,EAAE;;AAEjC,aAAO,UAAU,CAAC,aAAa,CAAC;KACjC;;;AAGD,0BAAsB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAClC,WAAO,UAAU,CAAC,aAAa,CAAC;GACjC,CAAC;;;AAGF,oCAAkC,CAAC,UAAU,GAAG,kCAAkC,CAAC;;AAEnF,MAAM,SAAS,GAAG,kCAAY,OAAO,CAAC,CAAC;;AAEvC,MAAM,MAAM,GAAG,SAAS,CAAC,gBAAgB;;AAEvC,SAAO;;AAEP,YAAU,CAAC,YAAY;;AAEvB,oCAAkC;;AAElC,OAAK,CACN,CAAC;;AAEF,SAAO,MAAM,CAAC,QAAQ,EAAE,EAAE;;GAEzB;;AAED,SAAO,sBAAsB,CAAC;CAC/B;;qBAEc,YAAiC;oEAAJ,EAAE;;MAArB,OAAO,SAAP,OAAO;MAAE,MAAM,SAAN,MAAM;;AACtC,SAAO,GAAG,gCAAU,OAAO,IAAI,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5D,QAAM,GAAG,gCAAU,MAAM,CAAC,CAAC;;AAE3B,MAAI,CAAC,MAAM,CAAC,MAAM,EAAE;AAClB,UAAM,IAAI,SAAS,CAAC,0DAA0D,CAAC,CAAC;GACjF;;AAED,SAAO,0BAA0B,CAAC;AAChC,WAAO,EAAP,OAAO;AACP,UAAM,EAAN,MAAM;GACP,CAAC,CAAC;CACJ","file":"insignificant-branches.js","sourcesContent":["\n// find all highest elements within context that do not contain any of the filter elements.\n// (basically the tree minus the parent paths of each filtered element reduced to the top most nodes)\n// originally inspired by Marcy Sutton's Material Dialog Component:\n// https://github.com/angular/material/blob/v0.11.1/src/components/dialog/dialog.js#L748-L783\n// to avoid this behavior: http://marcysutton.com/slides/mobile-a11y-seattlejs/#/36\n\nimport nodeArray from '../util/node-array';\nimport {getParentComparator} from '../util/compare-position';\nimport getDocument from '../util/get-document';\n\nfunction queryInsignificantBranches({context, filter}) {\n  const containsFilteredElement = function(node) {\n    const containsNode = getParentComparator({parent: node});\n    return filter.some(containsNode);\n  };\n\n  // We'd use a Set() for this, if we could\n  const insiginificantBranches = [];\n\n  // see https://developer.mozilla.org/en-US/docs/Web/API/NodeFilter\n  const CollectInsignificantBranchesFilter = function(node) {\n    if (filter.some(element => node === element)) {\n      // we've hit a filtered element and can ignore its children\n      return NodeFilter.FILTER_REJECT;\n    }\n\n    if (containsFilteredElement(node)) {\n      // we've hit a significant tree, so we'll have to keep investigating\n      return NodeFilter.FILTER_ACCEPT;\n    }\n\n    // we've found an insignificant tree\n    insiginificantBranches.push(node);\n    return NodeFilter.FILTER_REJECT;\n  };\n  // IE requires a function, Browsers require {acceptNode: function}\n  // see http://www.bennadel.com/blog/2607-finding-html-comment-nodes-in-the-dom-using-treewalker.htm\n  CollectInsignificantBranchesFilter.acceptNode = CollectInsignificantBranchesFilter;\n\n  const _document = getDocument(context);\n  // see https://developer.mozilla.org/en-US/docs/Web/API/Document/createTreeWalker\n  const walker = _document.createTreeWalker(\n    // root element to start search in\n    context,\n    // element type filter\n    NodeFilter.SHOW_ELEMENT,\n    // custom NodeFilter filter\n    CollectInsignificantBranchesFilter,\n    // deprecated, but IE requires it\n    false\n  );\n\n  while (walker.nextNode()) {\n    // collection things is happening through the filter method\n  }\n\n  return insiginificantBranches;\n}\n\nexport default function({context, filter} = {}) {\n  context = nodeArray(context || document.documentElement)[0];\n  filter = nodeArray(filter);\n\n  if (!filter.length) {\n    throw new TypeError('get/insignificant-branches requires valid options.filter');\n  }\n\n  return queryInsignificantBranches({\n    context,\n    filter,\n  });\n}\n"]}