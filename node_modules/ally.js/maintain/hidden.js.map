{"version":3,"sources":["../../src/maintain/hidden.js"],"names":[],"mappings":"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","file":"hidden.js","sourcesContent":["\n// Utility to make the entire DOM aria-hidden=\"true\" except for a given set of elements\n\nimport nodeArray from '../util/node-array';\nimport getInsignificantBranches from '../get/insignificant-branches';\nimport getParents from '../get/parents';\nimport toggleAttributeValue from '../util/toggle-attribute-value';\nimport {getParentComparator} from '../util/compare-position';\n\nfunction makeElementHidden(element) {\n  toggleAttributeValue({\n    element,\n    attribute: 'aria-hidden',\n    temporaryValue: 'true',\n  });\n}\n\nfunction undoElementHidden(element) {\n  toggleAttributeValue({\n    element,\n    attribute: 'aria-hidden',\n  });\n}\n\nconst observerConfig = {\n  attributes: false,\n  childList: true,\n  subtree: true,\n};\n\nclass HiddenSubtree {\n  constructor({context, filter} = {}) {\n    this._context = nodeArray(context || document.documentElement)[0];\n    this._filter = nodeArray(filter);\n\n    this.disengage = this.disengage.bind(this);\n    this.handleMutation = this.handleMutation.bind(this);\n    this.isInsignificantBranch = this.isInsignificantBranch.bind(this);\n\n    const insignificantBranches = getInsignificantBranches({context: this._context, filter: this._filter});\n    insignificantBranches.forEach(makeElementHidden);\n    this.startObserver();\n  }\n\n  disengage() {\n    if (!this._context) {\n      return;\n    }\n\n    [].forEach.call(this._context.querySelectorAll('[data-cached-aria-hidden]'), undoElementHidden);\n\n    this._context = null;\n    this._filter = null;\n    this._observer && this._observer.disconnect();\n    this._observer = null;\n  }\n\n  startObserver() {\n    if (!window.MutationObserver) {\n      // not supporting IE10 via Mutation Events, because they're too expensive\n      // https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events\n      return;\n    }\n    // http://caniuse.com/#search=mutation\n    // https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n    this._observer = new MutationObserver(mutations => mutations.forEach(this.handleMutation));\n    this._observer.observe(this._context, observerConfig);\n  }\n\n  handleMutation(mutation) {\n    if (mutation.type === 'childList') {\n      const addedElements = nodeArray(mutation.addedNodes).filter(element => element.nodeType === Node.ELEMENT_NODE);\n      if (!addedElements.length) {\n        return;\n      }\n\n      // a new branch cannot contain a filtered element\n      // (unless it is moved there, which is an edge-case we'll ignore for now),\n      // so anything that is within context,\n      // and not within a previously known insignificant branch and not within a filtered element,\n      // must be an insignificant branch as well\n      const insignificantBranches = addedElements.filter(this.isInsignificantBranch);\n      insignificantBranches.forEach(makeElementHidden);\n    }\n  }\n\n  isInsignificantBranch(element) {\n    const parents = getParents({context: element});\n    if (parents.some(_element => _element.getAttribute('aria-hidden') === 'true')) {\n      // element is child of a hidden element\n      return false;\n    }\n\n    const isParentOfElement = getParentComparator({element});\n    if (this._filter.some(isParentOfElement)) {\n      // element is a descendant of a filtered element\n      return false;\n    }\n\n    return true;\n  }\n}\n\nexport default function({context, filter} = {}) {\n  const service = new HiddenSubtree({context, filter});\n  return { disengage: service.disengage };\n}\n"]}