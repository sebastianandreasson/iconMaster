{"version":3,"sources":["../../src/event/shadow-focus.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;iCAe8B,wBAAwB;;;;mCAC1B,0BAA0B;;;;AAEtD,IAAI,MAAM,YAAA,CAAC;AACX,IAAI,SAAS,YAAA,CAAC;;AAEd,IAAI,OAAO,QAAQ,KAAK,WAAW,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,gBAAgB,EAAE;;AAEtE,QAAM,GAAG,SAAS,GAAG,YAAW,EAAE,CAAC;CACpC,MAAM;;AACL,QAAI,SAAS,YAAA,CAAC;AACd,QAAI,WAAW,YAAA,CAAC;AAChB,QAAI,iBAAiB,YAAA,CAAC;AACtB,QAAI,0BAA0B,YAAA,CAAC;;AAE/B,QAAM,sBAAsB,GAAG,SAAzB,sBAAsB,GAAc;AACxC,gCAA0B,EAAE,CAAC;;AAE7B,OAAC,MAAM,CAAC,cAAc,IAAI,MAAM,CAAC,YAAY,CAAA,CAAE,SAAS,CAAC,CAAC;AAC1D,eAAS,GAAG,CAAC,MAAM,CAAC,YAAY,IAAI,MAAM,CAAC,UAAU,CAAA,CAAE,YAAW;AAChE,yBAAiB,EAAE,CAAC;OACrB,CAAC,CAAC;KACJ,CAAC;;AAEF,QAAM,uBAAuB,GAAG,SAA1B,uBAAuB,CAAY,OAAO,EAAE;;AAEhD,aAAO,CAAC,gBAAgB,CAAC,MAAM,EAAE,sBAAsB,EAAE,IAAI,CAAC,CAAC;AAC/D,iBAAW,GAAG,OAAO,CAAC;KACvB,CAAC;;AAEF,8BAA0B,GAAG,YAAW;;AAEtC,iBAAW,IAAI,WAAW,CAAC,mBAAmB,CAAC,MAAM,EAAE,sBAAsB,EAAE,IAAI,CAAC,CAAC;AACrF,iBAAW,GAAG,IAAI,CAAC;KACpB,CAAC;;AAEF,qBAAiB,GAAG,YAAW;AAC7B,UAAM,OAAO,GAAG,qCAAmB,CAAC;AACpC,UAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE;AACxB,kCAA0B,EAAE,CAAC;AAC7B,eAAO;OACR;;;AAGD,6BAAuB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;AACpC,UAAM,gBAAgB,GAAG,IAAI,WAAW,CAAC,cAAc,EAAE;AACvD,eAAO,EAAE,KAAK;AACd,kBAAU,EAAE,KAAK;AACjB,cAAM,EAAE;;AAEN,kBAAQ,EAAE,OAAO;;AAEjB,gBAAM,EAAE,OAAO,CAAC,CAAC,CAAC;;AAElB,eAAK,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;SACxB;OACF,CAAC,CAAC;;AAEH,cAAQ,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;KAC1C,CAAC;;AAEF,QAAM,wBAAwB,GAAG,SAA3B,wBAAwB,GAAc;AAC1C,OAAC,MAAM,CAAC,cAAc,IAAI,MAAM,CAAC,YAAY,CAAA,CAAE,SAAS,CAAC,CAAC;AAC1D,uBAAiB,EAAE,CAAC;KACrB,CAAC;;AAEF,UAAM,GAAG,YAAW;AAClB,cAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,wBAAwB,EAAE,IAAI,CAAC,CAAC;KACpE,CAAC;;AAEF,aAAS,GAAG,YAAW;AACrB,OAAC,MAAM,CAAC,cAAc,IAAI,MAAM,CAAC,YAAY,CAAA,CAAE,SAAS,CAAC,CAAC;AAC1D,iBAAW,IAAI,WAAW,CAAC,mBAAmB,CAAC,MAAM,EAAE,sBAAsB,EAAE,IAAI,CAAC,CAAC;AACrF,cAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,wBAAwB,EAAE,IAAI,CAAC,CAAC;KACvE,CAAC;;CACH;;qBAEc,sCAAgB,EAAE,MAAM,EAAN,MAAM,EAAE,SAAS,EAAT,SAAS,EAAE,CAAC","file":"shadow-focus.js","sourcesContent":["\n/*\n  Utility to observe focus changes within Shadow DOMs.\n\n  USAGE:\n    engage();\n    document.body.addEventListener('shadow-focus', function(event) {\n      // event.detail.elements: complete focus ancestry (array of nodes)\n      // event.detail.active: the actually focused element within the Shadow DOM\n      // event.detail.hosts: the shadow host ancestry of the active element\n    }, false);\n\n  Alternate implementation: https://github.com/cdata/focus-observer\n*/\n\nimport getActiveElements from '../get/active-elements';\nimport decorateService from '../util/decorate-service';\n\nlet engage;\nlet disengage;\n\nif (typeof document === 'undefined' || !document.body.createShadowRoot) {\n  // no need to initialize any of this if we don't have Shadow DOM available\n  engage = disengage = function() {};\n} else {\n  let blurTimer;\n  let blurElement;\n  let handleFocusChange;\n  let stopHandleElementBlurEvent;\n\n  const handleElementBlurEvent = function() {\n    stopHandleElementBlurEvent();\n    // abort any handlers that come from document blur handler\n    (window.clearImmediate || window.clearTimeout)(blurTimer);\n    blurTimer = (window.setImmediate || window.setTimeout)(function() {\n      handleFocusChange();\n    });\n  };\n\n  const observeElementBlurEvent = function(element) {\n    // call us when we're leaving the element\n    element.addEventListener('blur', handleElementBlurEvent, true);\n    blurElement = element;\n  };\n\n  stopHandleElementBlurEvent = function() {\n    // once() - sometimes I miss jQuery's simplicityâ€¦\n    blurElement && blurElement.removeEventListener('blur', handleElementBlurEvent, true);\n    blurElement = null;\n  };\n\n  handleFocusChange = function() {\n    const _active = getActiveElements();\n    if (_active.length === 1) {\n      stopHandleElementBlurEvent();\n      return;\n    }\n\n    // listen for blur so we know when to re-validate\n    observeElementBlurEvent(_active[0]);\n    const shadowFocusEvent = new CustomEvent('shadow-focus', {\n      bubbles: false,\n      cancelable: false,\n      detail: {\n        // complete focus ancestry\n        elements: _active,\n        // the actually focused element\n        active: _active[0],\n        // shadow host ancestry\n        hosts: _active.slice(1),\n      },\n    });\n\n    document.dispatchEvent(shadowFocusEvent);\n  };\n\n  const handleDocumentFocusEvent = function() {\n    (window.clearImmediate || window.clearTimeout)(blurTimer);\n    handleFocusChange();\n  };\n\n  engage = function() {\n    document.addEventListener('focus', handleDocumentFocusEvent, true);\n  };\n\n  disengage = function() {\n    (window.clearImmediate || window.clearTimeout)(blurTimer);\n    blurElement && blurElement.removeEventListener('blur', handleElementBlurEvent, true);\n    document.removeEventListener('focus', handleDocumentFocusEvent, true);\n  };\n}\n\nexport default decorateService({ engage, disengage });\n"]}