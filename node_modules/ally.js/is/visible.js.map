{"version":3,"sources":["../../src/is/visible.js"],"names":[],"mappings":"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","file":"visible.js","sourcesContent":["\n// determine if an element is rendered\n// NOTE: that does not mean an element is visible in the viewport, see util/visible-area\n\nimport 'array.prototype.findindex';\nimport getParents from '../get/parents';\n\n// http://www.w3.org/TR/html5/rendering.html#being-rendered\n// <area> is not rendered, but we *consider* it visible to simplfiy this function's usage\nconst notRenderedElementsPattern = /^(area)$/;\n\nfunction computedStyle(element, property) {\n  return window.getComputedStyle(element, null)\n    .getPropertyValue(property);\n}\n\nfunction notDisplayed(_path) {\n  return _path.some(function(element) {\n    // display:none is not visible (optimized away at layout)\n    return computedStyle(element, 'display') === 'none';\n  });\n}\n\nfunction notVisible(_path) {\n  // https://github.com/jquery/jquery-ui/blob/master/ui/core.js#L109-L114\n  // NOTE: a nested element can reverse visibility:hidden|collapse by explicitly setting visibility:visible\n  // NOTE: visibility can be [\"\", \"visible\", \"hidden\", \"collapse\"]\n  const hidden = _path.findIndex(function(element) {\n    const visibility = computedStyle(element, 'visibility');\n    return visibility === 'hidden' || visibility === 'collapse';\n  });\n\n  if (hidden === -1) {\n    // there is no hidden element\n    return false;\n  }\n\n  const visible = _path.findIndex(function(element) {\n    return computedStyle(element, 'visibility') === 'visible';\n  });\n\n  if (visible === -1) {\n    // there is no visible element (but a hidden element)\n    return true;\n  }\n\n  if (hidden < visible) {\n    // there is a hidden element and it's closer than the first visible element\n    return true;\n  }\n\n  // there may be a hidden element, but the closest element is visible\n  return false;\n}\n\nfunction collapsedParent(_path) {\n  let offset = 1;\n  if (_path[0].nodeName.toLowerCase() === 'summary') {\n    offset = 2;\n  }\n\n  return _path.slice(offset).some(function(element) {\n    // \"content children\" of a closed details element are not visible\n    return element.nodeName.toLowerCase() === 'details' && element.open === false;\n  });\n}\n\nexport default function(element) {\n  if (element === document) {\n    element = document.documentElement;\n  }\n\n  if (!element || element.nodeType !== Node.ELEMENT_NODE) {\n    throw new TypeError('is/visible requires an argument of type Element');\n  }\n\n  const nodeName = element.nodeName.toLowerCase();\n  if (notRenderedElementsPattern.test(nodeName)) {\n    return true;\n  }\n\n  const _path = getParents({context: element});\n\n  // in Internet Explorer <audio> has a default display: none, where others have display: inline\n  // but IE allows focusing <audio style=\"display:none\">, but not <div display:none><audio>\n  // this is irrelevant to other browsers, as the controls attribute is required to make <audio> focusable\n  const isAudioWithoutControls = nodeName === 'audio' && !element.hasAttribute('controls');\n  if (notDisplayed(isAudioWithoutControls ? _path.slice(1) : _path)) {\n    return false;\n  }\n\n  if (notVisible(_path)) {\n    return false;\n  }\n\n  if (collapsedParent(_path)) {\n    return false;\n  }\n\n  return true;\n}\n"]}