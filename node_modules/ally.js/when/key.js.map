{"version":3,"sources":["../../src/when/key.js"],"names":[],"mappings":";;;;;;;;0BACuB,eAAe;;;;6BAChB,oBAAoB;;;;mCACR,0BAA0B;;;;;qBAK7C,YAAmB;MAAV,GAAG,yDAAG,EAAE;;AAC9B,MAAI,SAAS,YAAA,CAAC;AACd,MAAM,QAAQ,GAAG,EAAE,CAAC;;AAEpB,MAAM,OAAO,GAAG,gCAAU,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,QAAQ,CAAC,eAAe,CAAC;AACtE,SAAO,GAAG,CAAC,OAAO,CAAC;AACnB,MAAM,MAAM,GAAG,gCAAU,GAAG,CAAC,MAAM,CAAC,CAAC;AACrC,SAAO,GAAG,CAAC,MAAM,CAAC;;AAElB,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACjC,MAAI,CAAC,OAAO,CAAC,MAAM,EAAE;AACnB,UAAM,IAAI,SAAS,CAAC,2CAA2C,CAAC,CAAC;GAClE;;AAED,MAAM,eAAe,GAAG,SAAlB,eAAe,CAAY,KAAK,EAAE;AACtC,SAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAS,IAAI,EAAE;AACpC,UAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;AACnB,gBAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;OACrB;;AAED,cAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KAC5B,CAAC,CAAC;GACJ,CAAC;;AAEF,SAAO,CAAC,OAAO,CAAC,UAAS,IAAI,EAAE;AAC7B,QAAI,OAAO,GAAG,CAAC,IAAI,CAAC,KAAK,UAAU,EAAE;AACnC,YAAM,IAAI,SAAS,CAAC,4BAA4B,GAAG,IAAI,GAAG,qBAAqB,CAAC,CAAC;KAClF;;AAED,QAAM,WAAW,GAAG,SAAd,WAAW,CAAY,KAAK,EAAE;AAClC,WAAK,CAAC,QAAQ,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC;AAC3B,aAAO,KAAK,CAAC;KACd,CAAC;;AAEF,iCAAW,IAAI,CAAC,CACb,GAAG,CAAC,WAAW,CAAC,CAChB,OAAO,CAAC,eAAe,CAAC,CAAC;GAC7B,CAAC,CAAC;;AAEH,MAAM,aAAa,GAAG,SAAhB,aAAa,CAAY,KAAK,EAAE;AACpC,QAAI,KAAK,CAAC,gBAAgB,EAAE;AAC1B,aAAO;KACR;;AAED,QAAI,MAAM,CAAC,MAAM,EAAE;;AAEjB,UAAM,iBAAiB,GAAG,8CAAoB,EAAC,OAAO,EAAE,KAAK,CAAC,MAAM,EAAE,WAAW,EAAE,IAAI,EAAC,CAAC,CAAC;AAC1F,UAAI,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAE;AAClC,eAAO;OACR;KACF;;AAED,QAAM,GAAG,GAAG,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,KAAK,CAAC;AACzC,QAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;AAClB,aAAO;KACR;;AAED,YAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,UAAS,MAAM,EAAE;AACrC,UAAI,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;AACjC,eAAO;OACR;;AAED,YAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,SAAS,CAAC,CAAC;KACjD,CAAC,CAAC;GACJ,CAAC;;AAEF,SAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,aAAa,EAAE,KAAK,CAAC,CAAC;;AAE1D,WAAS,GAAG,YAAW;AACrB,WAAO,CAAC,mBAAmB,CAAC,SAAS,EAAE,aAAa,EAAE,KAAK,CAAC,CAAC;GAC9D,CAAC;;AAEF,SAAO,EAAE,SAAS,EAAT,SAAS,EAAE,CAAC;CACtB","file":"key.js","sourcesContent":["\nimport keyBinding from './key.binding';\nimport nodeArray from '../util/node-array';\nimport {getParentComparator} from '../util/compare-position';\n\n// Bug 286933 - Key events in the autocomplete popup should be hidden from page scripts\n// @browser-issue Gecko https://bugzilla.mozilla.org/show_bug.cgi?id=286933\n\nexport default function(map = {}) {\n  let disengage;\n  const bindings = {};\n\n  const context = nodeArray(map.context)[0] || document.documentElement;\n  delete map.context;\n  const filter = nodeArray(map.filter);\n  delete map.filter;\n\n  const mapKeys = Object.keys(map);\n  if (!mapKeys.length) {\n    throw new TypeError('when/key requires at least one option key');\n  }\n\n  const registerBinding = function(event) {\n    event.keyCodes.forEach(function(code) {\n      if (!bindings[code]) {\n        bindings[code] = [];\n      }\n\n      bindings[code].push(event);\n    });\n  };\n\n  mapKeys.forEach(function(text) {\n    if (typeof map[text] !== 'function') {\n      throw new TypeError('when/key requires option[\"' + text + '\"] to be a function');\n    }\n\n    const addCallback = function(event) {\n      event.callback = map[text];\n      return event;\n    };\n\n    keyBinding(text)\n      .map(addCallback)\n      .forEach(registerBinding);\n  });\n\n  const handleKeyDown = function(event) {\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    if (filter.length) {\n      // ignore elements within the exempted sub-trees\n      const isParentOfElement = getParentComparator({element: event.target, includeSelf: true});\n      if (filter.some(isParentOfElement)) {\n        return;\n      }\n    }\n\n    const key = event.keyCode || event.which;\n    if (!bindings[key]) {\n      return;\n    }\n\n    bindings[key].forEach(function(_event) {\n      if (!_event.matchModifiers(event)) {\n        return;\n      }\n\n      _event.callback.call(context, event, disengage);\n    });\n  };\n\n  context.addEventListener('keydown', handleKeyDown, false);\n\n  disengage = function() {\n    context.removeEventListener('keydown', handleKeyDown, false);\n  };\n\n  return { disengage };\n}\n"]}