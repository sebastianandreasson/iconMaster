{"version":3,"sources":["../../src/observe/interaction-type.js"],"names":[],"mappings":"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","file":"interaction-type.js","sourcesContent":["\n/*\n  Observe keyboard-, pointer-, mouse- and touch-events so that a query for\n  the current interaction type can be made at any time. For pointer interaction\n  this observer is limited to pointer button down/up - move is not observed!\n\n  USAGE:\n    var listener = engage();\n    listener.get() === {pointer: Boolean, key: Boolean}\n*/\n\nimport decorateService from '../util/decorate-service';\n\n// counters to track primary input\nlet _activePointers = 0;\nlet _activeKeys = 0;\n\nconst pointerStartEvents = [\n  'touchstart',\n  'pointerdown',\n  'MSPointerDown',\n  'mousedown',\n];\nconst pointerEndEvents = [\n  'touchend',\n  'touchcancel',\n  'pointerup',\n  'MSPointerUp',\n  'pointercancel',\n  'MSPointerCancel',\n  'mouseup',\n];\n\nfunction handleWindowBlurEvent() {\n  // reset internal counters when window loses focus\n  _activePointers = 0;\n  _activeKeys = 0;\n}\n\nfunction handlePointerStartEvent(event) {\n  if (event.isPrimary === false) {\n    // ignore non-primary pointer events\n    // https://w3c.github.io/pointerevents/#widl-PointerEvent-isPrimary\n    return;\n  }\n\n  // mousedown without following mouseup\n  // (likely not possible in Chrome)\n  _activePointers++;\n}\n\nfunction handlePointerEndEvent(event) {\n  if (event.isPrimary === false) {\n    // ignore non-primary pointer events\n    // https://w3c.github.io/pointerevents/#widl-PointerEvent-isPrimary\n    return;\n  } else if (event.touches) {\n    _activePointers = event.touches.length;\n    return;\n  }\n\n  // delay reset to when the current handlers are executed\n  (window.setImmediate || window.setTimeout)(function() {\n    // mouseup without prior mousedown\n    // (drag something out of the window)\n    _activePointers = Math.max(_activePointers - 1, 0);\n  });\n}\n\nfunction handleKeyStartEvent(event) {\n  // ignore modifier keys\n  switch (event.keyCode || event.which) {\n    case 16: // space\n    case 17: // control\n    case 18: // alt\n    case 91: // command left\n    case 93: // command right\n      return;\n  }\n\n  // keydown without a following keyup\n  // (may happen on CMD+TAB)\n  _activeKeys++;\n}\n\nfunction handleKeyEndEvent(event) {\n  // ignore modifier keys\n  switch (event.keyCode || event.which) {\n    case 16: // space\n    case 17: // control\n    case 18: // alt\n    case 91: // command left\n    case 93: // command right\n      return;\n  }\n\n  // delay reset to when the current handlers are executed\n  (window.setImmediate || window.setTimeout)(function() {\n    // keyup without prior keydown\n    // (may happen on CMD+R)\n    _activeKeys = Math.max(_activeKeys - 1, 0);\n  });\n}\n\nfunction getInteractionType() {\n  return {\n    pointer: Boolean(_activePointers),\n    key: Boolean(_activeKeys),\n  };\n}\n\nfunction disengage() {\n  _activePointers = _activeKeys = 0;\n  window.removeEventListener('blur', handleWindowBlurEvent, false);\n  document.documentElement.removeEventListener('keydown', handleKeyStartEvent, true);\n  document.documentElement.removeEventListener('keyup', handleKeyEndEvent, true);\n  pointerStartEvents.forEach(function(event) {\n    document.documentElement.removeEventListener(event, handlePointerStartEvent, true);\n  });\n  pointerEndEvents.forEach(function(event) {\n    document.documentElement.removeEventListener(event, handlePointerEndEvent, true);\n  });\n}\n\nfunction engage() {\n  // window blur must be in bubble phase so it won't capture regular blurs\n  window.addEventListener('blur', handleWindowBlurEvent, false);\n  // handlers to identify the method of focus change\n  document.documentElement.addEventListener('keydown', handleKeyStartEvent, true);\n  document.documentElement.addEventListener('keyup', handleKeyEndEvent, true);\n  pointerStartEvents.forEach(function(event) {\n    document.documentElement.addEventListener(event, handlePointerStartEvent, true);\n  });\n  pointerEndEvents.forEach(function(event) {\n    document.documentElement.addEventListener(event, handlePointerEndEvent, true);\n  });\n\n  return {\n    get: getInteractionType,\n  };\n}\n\nexport default decorateService({ engage, disengage });\n"]}