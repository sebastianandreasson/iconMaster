{"version":3,"sources":["../../src/style/focus-within.js"],"names":[],"mappings":"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","file":"focus-within.js","sourcesContent":["\n/*\n  add .ally-focus-within class to parents of document.activeElement,\n  to provide the functionality of :focus-within where it's not available\n  see http://dev.w3.org/csswg/selectors-4/#the-focus-within-pseudo\n\n  USAGE:\n    style/focus-within()\n*/\n\nimport 'domtokenlist-shim';\nimport shadowFocus from '../event/shadow-focus';\nimport getActiveElements from '../get/active-elements';\nimport getParents from '../get/parents';\nimport decorateService from '../util/decorate-service';\n\nimport _supports from './focus-within.supports';\nlet supports;\n\n// preferring focusin/out because they are synchronous in IE10+11\nconst focusEventName = typeof document !== 'undefined' && ('onfocusin' in document ? 'focusin' : 'focus');\nconst blurEventName = typeof document !== 'undefined' && ('onfocusin' in document ? 'focusout' : 'blur');\n\n// NOTE: require classList polyfill may be necessary (not available on SVGElement)\n// http://caniuse.com/#feat=classlist available since IE10\n// https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills#classlist\n// https://developer.mozilla.org/en-US/docs/Web/API/Element.classList\n\nconst className = 'ally-focus-within';\nlet blurTimer;\nlet shadowHandle;\n\nfunction applyFocusWithinClass(active) {\n  let _active = active || getActiveElements();\n  let selector = '.' + className;\n  if (supports.cssShadowPiercingDeepCombinator) {\n    // select elements in shadow dom as well\n    selector += ', html ' + supports.cssShadowPiercingDeepCombinator + ' ' + selector;\n  } else {\n    // no shadow-piercing descendant selector, no joy\n    _active = _active.slice(-1);\n  }\n\n  // identify the elements that currently have :focus-within\n  const _current = [].slice.call(document.querySelectorAll(selector), 0);\n  // get the path (ancestry) of each ShadowRoot and merge them into a flat list\n  const elements = _active.map((context) => getParents({context})).reduce(function(previous, current) {\n    return current.concat(previous);\n  }, []);\n\n  // remove the class only from elements that would not receive it again (minimize dom action)\n  _current.forEach(function(element) {\n    if (elements.indexOf(element) !== -1) {\n      return;\n    }\n\n    element.classList.remove(className);\n  });\n\n  // apply the class only to elements that do not yet have it (minimize dom action)\n  elements.forEach(function(element) {\n    if (_current.indexOf(element) !== -1) {\n      return;\n    }\n\n    element.classList.add(className);\n  });\n}\n\nfunction handleDocumentBlurEvent() {\n  // we won't get a focus for <body>, but a delayed blur handler will achieve\n  // the same thing listening for focus would've done, unless we get a focus, of course\n  blurTimer = (window.setImmediate || window.setTimeout)(function() {\n    applyFocusWithinClass();\n  });\n}\n\nfunction handleDocumentFocusEvent() {\n  // abort any handlers that come from document or element blur handlers\n  (window.clearImmediate || window.clearTimeout)(blurTimer);\n  // NOTE: we could overcome Firefox 34 issue of not supporting ShadowRoot.host by\n  // passing event.target (which references the first-level ShadowHost), but that\n  // would require applyFocusWithinClass() to distinguish between the argument and\n  // getActiveElements().\n  applyFocusWithinClass();\n}\n\nfunction handleShadowFocusEvent(event) {\n  applyFocusWithinClass(event.detail.elements);\n}\n\nfunction disengage() {\n  shadowHandle && shadowHandle.disengage();\n  (window.clearImmediate || window.clearTimeout)(blurTimer);\n  document.removeEventListener(blurEventName, handleDocumentBlurEvent, true);\n  document.removeEventListener(focusEventName, handleDocumentFocusEvent, true);\n  document.removeEventListener('shadow-focus', handleShadowFocusEvent, true);\n\n  let selector = '.' + className;\n  if (supports.cssShadowPiercingDeepCombinator) {\n    // select elements in shadow dom as well\n    selector += ', html ' + supports.cssShadowPiercingDeepCombinator + ' ' + selector;\n  }\n\n  // remove any remaining ally-within-focus occurrences\n  [].forEach.call(document.querySelectorAll(selector), function(element) {\n    element.classList.remove(className);\n  });\n}\n\nfunction engage() {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  shadowHandle = shadowFocus();\n  document.addEventListener(blurEventName, handleDocumentBlurEvent, true);\n  document.addEventListener(focusEventName, handleDocumentFocusEvent, true);\n  document.addEventListener('shadow-focus', handleShadowFocusEvent, true);\n  applyFocusWithinClass();\n}\n\nexport default decorateService({ engage, disengage });\n"]}