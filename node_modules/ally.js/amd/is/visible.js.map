{"version":3,"sources":["../../src/is/visible.js"],"names":[],"mappings":";;;;;;;;;;;;AASA,MAAM,0BAA0B,GAAG,UAAU,CAAC;;AAE9C,WAAS,aAAa,CAAC,OAAO,EAAE,QAAQ,EAAE;AACxC,WAAO,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,CAC1C,gBAAgB,CAAC,QAAQ,CAAC,CAAC;GAC/B;;AAED,WAAS,YAAY,CAAC,KAAK,EAAE;AAC3B,WAAO,KAAK,CAAC,IAAI,CAAC,UAAS,OAAO,EAAE;;AAElC,aAAO,aAAa,CAAC,OAAO,EAAE,SAAS,CAAC,KAAK,MAAM,CAAC;KACrD,CAAC,CAAC;GACJ;;AAED,WAAS,UAAU,CAAC,KAAK,EAAE;;;;AAIzB,QAAM,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,UAAS,OAAO,EAAE;AAC/C,UAAM,UAAU,GAAG,aAAa,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;AACxD,aAAO,UAAU,KAAK,QAAQ,IAAI,UAAU,KAAK,UAAU,CAAC;KAC7D,CAAC,CAAC;;AAEH,QAAI,MAAM,KAAK,CAAC,CAAC,EAAE;;AAEjB,aAAO,KAAK,CAAC;KACd;;AAED,QAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,UAAS,OAAO,EAAE;AAChD,aAAO,aAAa,CAAC,OAAO,EAAE,YAAY,CAAC,KAAK,SAAS,CAAC;KAC3D,CAAC,CAAC;;AAEH,QAAI,OAAO,KAAK,CAAC,CAAC,EAAE;;AAElB,aAAO,IAAI,CAAC;KACb;;AAED,QAAI,MAAM,GAAG,OAAO,EAAE;;AAEpB,aAAO,IAAI,CAAC;KACb;;;AAGD,WAAO,KAAK,CAAC;GACd;;AAED,WAAS,eAAe,CAAC,KAAK,EAAE;AAC9B,QAAI,MAAM,GAAG,CAAC,CAAC;AACf,QAAI,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,WAAW,EAAE,KAAK,SAAS,EAAE;AACjD,YAAM,GAAG,CAAC,CAAC;KACZ;;AAED,WAAO,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,UAAS,OAAO,EAAE;;AAEhD,aAAO,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,KAAK,SAAS,IAAI,OAAO,CAAC,IAAI,KAAK,KAAK,CAAC;KAC/E,CAAC,CAAC;GACJ;;mBAEc,UAAS,OAAO,EAAE;AAC/B,QAAI,OAAO,KAAK,QAAQ,EAAE;AACxB,aAAO,GAAG,QAAQ,CAAC,eAAe,CAAC;KACpC;;AAED,QAAI,CAAC,OAAO,IAAI,OAAO,CAAC,QAAQ,KAAK,IAAI,CAAC,YAAY,EAAE;AACtD,YAAM,IAAI,SAAS,CAAC,iDAAiD,CAAC,CAAC;KACxE;;AAED,QAAM,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;AAChD,QAAI,0BAA0B,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;AAC7C,aAAO,IAAI,CAAC;KACb;;AAED,QAAM,KAAK,GAAG,6BAAW,EAAC,OAAO,EAAE,OAAO,EAAC,CAAC,CAAC;;;;;AAK7C,QAAM,sBAAsB,GAAG,QAAQ,KAAK,OAAO,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;AACzF,QAAI,YAAY,CAAC,sBAAsB,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,EAAE;AACjE,aAAO,KAAK,CAAC;KACd;;AAED,QAAI,UAAU,CAAC,KAAK,CAAC,EAAE;AACrB,aAAO,KAAK,CAAC;KACd;;AAED,QAAI,eAAe,CAAC,KAAK,CAAC,EAAE;AAC1B,aAAO,KAAK,CAAC;KACd;;AAED,WAAO,IAAI,CAAC;GACb","file":"visible.js","sourcesContent":["\n// determine if an element is rendered\n// NOTE: that does not mean an element is visible in the viewport, see util/visible-area\n\nimport 'array.prototype.findindex';\nimport getParents from '../get/parents';\n\n// http://www.w3.org/TR/html5/rendering.html#being-rendered\n// <area> is not rendered, but we *consider* it visible to simplfiy this function's usage\nconst notRenderedElementsPattern = /^(area)$/;\n\nfunction computedStyle(element, property) {\n  return window.getComputedStyle(element, null)\n    .getPropertyValue(property);\n}\n\nfunction notDisplayed(_path) {\n  return _path.some(function(element) {\n    // display:none is not visible (optimized away at layout)\n    return computedStyle(element, 'display') === 'none';\n  });\n}\n\nfunction notVisible(_path) {\n  // https://github.com/jquery/jquery-ui/blob/master/ui/core.js#L109-L114\n  // NOTE: a nested element can reverse visibility:hidden|collapse by explicitly setting visibility:visible\n  // NOTE: visibility can be [\"\", \"visible\", \"hidden\", \"collapse\"]\n  const hidden = _path.findIndex(function(element) {\n    const visibility = computedStyle(element, 'visibility');\n    return visibility === 'hidden' || visibility === 'collapse';\n  });\n\n  if (hidden === -1) {\n    // there is no hidden element\n    return false;\n  }\n\n  const visible = _path.findIndex(function(element) {\n    return computedStyle(element, 'visibility') === 'visible';\n  });\n\n  if (visible === -1) {\n    // there is no visible element (but a hidden element)\n    return true;\n  }\n\n  if (hidden < visible) {\n    // there is a hidden element and it's closer than the first visible element\n    return true;\n  }\n\n  // there may be a hidden element, but the closest element is visible\n  return false;\n}\n\nfunction collapsedParent(_path) {\n  let offset = 1;\n  if (_path[0].nodeName.toLowerCase() === 'summary') {\n    offset = 2;\n  }\n\n  return _path.slice(offset).some(function(element) {\n    // \"content children\" of a closed details element are not visible\n    return element.nodeName.toLowerCase() === 'details' && element.open === false;\n  });\n}\n\nexport default function(element) {\n  if (element === document) {\n    element = document.documentElement;\n  }\n\n  if (!element || element.nodeType !== Node.ELEMENT_NODE) {\n    throw new TypeError('is/visible requires an argument of type Element');\n  }\n\n  const nodeName = element.nodeName.toLowerCase();\n  if (notRenderedElementsPattern.test(nodeName)) {\n    return true;\n  }\n\n  const _path = getParents({context: element});\n\n  // in Internet Explorer <audio> has a default display: none, where others have display: inline\n  // but IE allows focusing <audio style=\"display:none\">, but not <div display:none><audio>\n  // this is irrelevant to other browsers, as the controls attribute is required to make <audio> focusable\n  const isAudioWithoutControls = nodeName === 'audio' && !element.hasAttribute('controls');\n  if (notDisplayed(isAudioWithoutControls ? _path.slice(1) : _path)) {\n    return false;\n  }\n\n  if (notVisible(_path)) {\n    return false;\n  }\n\n  if (collapsedParent(_path)) {\n    return false;\n  }\n\n  return true;\n}\n"]}