{"version":3,"sources":["../../src/when/key.js"],"names":[],"mappings":";;;;;;;;;;;mBAQe,YAAmB;QAAV,GAAG,yDAAG,EAAE;;AAC9B,QAAI,SAAS,YAAA,CAAC;AACd,QAAM,QAAQ,GAAG,EAAE,CAAC;;AAEpB,QAAM,OAAO,GAAG,2BAAU,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,QAAQ,CAAC,eAAe,CAAC;AACtE,WAAO,GAAG,CAAC,OAAO,CAAC;AACnB,QAAM,MAAM,GAAG,2BAAU,GAAG,CAAC,MAAM,CAAC,CAAC;AACrC,WAAO,GAAG,CAAC,MAAM,CAAC;;AAElB,QAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACjC,QAAI,CAAC,OAAO,CAAC,MAAM,EAAE;AACnB,YAAM,IAAI,SAAS,CAAC,2CAA2C,CAAC,CAAC;KAClE;;AAED,QAAM,eAAe,GAAG,SAAlB,eAAe,CAAY,KAAK,EAAE;AACtC,WAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAS,IAAI,EAAE;AACpC,YAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;AACnB,kBAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;SACrB;;AAED,gBAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;OAC5B,CAAC,CAAC;KACJ,CAAC;;AAEF,WAAO,CAAC,OAAO,CAAC,UAAS,IAAI,EAAE;AAC7B,UAAI,OAAO,GAAG,CAAC,IAAI,CAAC,KAAK,UAAU,EAAE;AACnC,cAAM,IAAI,SAAS,CAAC,4BAA4B,GAAG,IAAI,GAAG,qBAAqB,CAAC,CAAC;OAClF;;AAED,UAAM,WAAW,GAAG,SAAd,WAAW,CAAY,KAAK,EAAE;AAClC,aAAK,CAAC,QAAQ,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC;AAC3B,eAAO,KAAK,CAAC;OACd,CAAC;;AAEF,mCAAW,IAAI,CAAC,CACb,GAAG,CAAC,WAAW,CAAC,CAChB,OAAO,CAAC,eAAe,CAAC,CAAC;KAC7B,CAAC,CAAC;;AAEH,QAAM,aAAa,GAAG,SAAhB,aAAa,CAAY,KAAK,EAAE;AACpC,UAAI,KAAK,CAAC,gBAAgB,EAAE;AAC1B,eAAO;OACR;;AAED,UAAI,MAAM,CAAC,MAAM,EAAE;;AAEjB,YAAM,iBAAiB,GAAG,yBAnDxB,mBAAmB,EAmDyB,EAAC,OAAO,EAAE,KAAK,CAAC,MAAM,EAAE,WAAW,EAAE,IAAI,EAAC,CAAC,CAAC;AAC1F,YAAI,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAE;AAClC,iBAAO;SACR;OACF;;AAED,UAAM,GAAG,GAAG,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,KAAK,CAAC;AACzC,UAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;AAClB,eAAO;OACR;;AAED,cAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,UAAS,MAAM,EAAE;AACrC,YAAI,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;AACjC,iBAAO;SACR;;AAED,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,SAAS,CAAC,CAAC;OACjD,CAAC,CAAC;KACJ,CAAC;;AAEF,WAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,aAAa,EAAE,KAAK,CAAC,CAAC;;AAE1D,aAAS,GAAG,YAAW;AACrB,aAAO,CAAC,mBAAmB,CAAC,SAAS,EAAE,aAAa,EAAE,KAAK,CAAC,CAAC;KAC9D,CAAC;;AAEF,WAAO,EAAE,SAAS,EAAT,SAAS,EAAE,CAAC;GACtB","file":"key.js","sourcesContent":["\nimport keyBinding from './key.binding';\nimport nodeArray from '../util/node-array';\nimport {getParentComparator} from '../util/compare-position';\n\n// Bug 286933 - Key events in the autocomplete popup should be hidden from page scripts\n// @browser-issue Gecko https://bugzilla.mozilla.org/show_bug.cgi?id=286933\n\nexport default function(map = {}) {\n  let disengage;\n  const bindings = {};\n\n  const context = nodeArray(map.context)[0] || document.documentElement;\n  delete map.context;\n  const filter = nodeArray(map.filter);\n  delete map.filter;\n\n  const mapKeys = Object.keys(map);\n  if (!mapKeys.length) {\n    throw new TypeError('when/key requires at least one option key');\n  }\n\n  const registerBinding = function(event) {\n    event.keyCodes.forEach(function(code) {\n      if (!bindings[code]) {\n        bindings[code] = [];\n      }\n\n      bindings[code].push(event);\n    });\n  };\n\n  mapKeys.forEach(function(text) {\n    if (typeof map[text] !== 'function') {\n      throw new TypeError('when/key requires option[\"' + text + '\"] to be a function');\n    }\n\n    const addCallback = function(event) {\n      event.callback = map[text];\n      return event;\n    };\n\n    keyBinding(text)\n      .map(addCallback)\n      .forEach(registerBinding);\n  });\n\n  const handleKeyDown = function(event) {\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    if (filter.length) {\n      // ignore elements within the exempted sub-trees\n      const isParentOfElement = getParentComparator({element: event.target, includeSelf: true});\n      if (filter.some(isParentOfElement)) {\n        return;\n      }\n    }\n\n    const key = event.keyCode || event.which;\n    if (!bindings[key]) {\n      return;\n    }\n\n    bindings[key].forEach(function(_event) {\n      if (!_event.matchModifiers(event)) {\n        return;\n      }\n\n      _event.callback.call(context, event, disengage);\n    });\n  };\n\n  context.addEventListener('keydown', handleKeyDown, false);\n\n  disengage = function() {\n    context.removeEventListener('keydown', handleKeyDown, false);\n  };\n\n  return { disengage };\n}\n"]}